{"ast":null,"code":"\"use strict\";var _defineProperty=require(\"@babel/runtime/helpers/defineProperty\");var _objectWithoutProperties=require(\"@babel/runtime/helpers/objectWithoutProperties\");var _excluded=[\"source\"],_excluded2=[\"onDocumentMetadataLoaded\",\"onTTreeChange\",\"contentWidth\"],_excluded3=[\"source\"],_excluded4=[\"source\"];function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=exports.renderSourcePropTypes=void 0;var _equals=_interopRequireDefault(require(\"ramda/src/equals\"));var _react=_interopRequireWildcard(require(\"react\"));var _reactNative=require(\"react-native-web/dist/index\");var _propTypes=_interopRequireDefault(require(\"prop-types\"));var _ttreeEventsContext=_interopRequireDefault(require(\"./context/ttreeEventsContext\"));var _isUriSource=_interopRequireDefault(require(\"./helpers/isUriSource\"));var _SourceLoaderUri=_interopRequireDefault(require(\"./SourceLoaderUri\"));var _SourceLoaderInline=_interopRequireDefault(require(\"./SourceLoaderInline\"));var _SourceLoaderDom=_interopRequireDefault(require(\"./SourceLoaderDom\"));var _debugMessages=_interopRequireDefault(require(\"./debugMessages\"));var _contentWidthContext=_interopRequireDefault(require(\"./context/contentWidthContext\"));var _isDomSource=_interopRequireDefault(require(\"./helpers/isDomSource\"));var _useProfiler=_interopRequireDefault(require(\"./hooks/useProfiler\"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!==\"function\")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!==\"default\"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var renderSourcePropTypes={source:_propTypes.default.oneOfType([_propTypes.default.shape({html:_propTypes.default.string.isRequired,baseUrl:_propTypes.default.string}),_propTypes.default.shape({dom:_propTypes.default.object.isRequired,baseUrl:_propTypes.default.string}),_propTypes.default.shape({uri:_propTypes.default.string.isRequired,method:_propTypes.default.string,body:_propTypes.default.any,headers:_propTypes.default.object})]),onTTreeChange:_propTypes.default.func,onHTMLLoaded:_propTypes.default.func,onDocumentMetadataLoaded:_propTypes.default.func,contentWidth:_propTypes.default.number};exports.renderSourcePropTypes=renderSourcePropTypes;function isEmptySource(source){return!source||typeof source.uri!=='string'&&typeof source.html!=='string'&&!source.dom;}function RawSourceLoader(_ref){var source=_ref.source,props=_objectWithoutProperties(_ref,_excluded);if(isEmptySource(source)){if(typeof __DEV__==='boolean'&&__DEV__){console.warn(_debugMessages.default.noSource);}return null;}if((0,_isUriSource.default)(source)){return _react.default.createElement(_SourceLoaderUri.default,_objectSpread({source:source},props));}if((0,_isDomSource.default)(source)){return _react.default.createElement(_SourceLoaderDom.default,_objectSpread({source:source},props));}return _react.default.createElement(_SourceLoaderInline.default,_objectSpread({source:source},props));}function shallowEqual(prop1,prop2){if(!(0,_equals.default)(Object.keys(prop1),Object.keys(prop2))){return false;}for(var key in prop1){if(prop1[key]!==prop2[key]){return false;}}return true;}var RenderHTMLSource=(0,_react.memo)(function RenderHtmlSource(_ref2){var onDocumentMetadataLoaded=_ref2.onDocumentMetadataLoaded,onTTreeChange=_ref2.onTTreeChange,contentWidth=_ref2.contentWidth,props=_objectWithoutProperties(_ref2,_excluded2);var profile=(0,_useProfiler.default)({prop:'onDocumentMetadataLoaded or onTTreeChange'});var ttreeEvents=(0,_react.useMemo)(function(){typeof __DEV__==='boolean'&&__DEV__&&profile();return{onDocumentMetadataLoaded:onDocumentMetadataLoaded,onTTreeChange:onTTreeChange};},[onDocumentMetadataLoaded,onTTreeChange,profile]);if(typeof __DEV__==='boolean'&&__DEV__){if(!(typeof contentWidth==='number')){console.warn(_debugMessages.default.contentWidth);}}return _react.default.createElement(_ttreeEventsContext.default.Provider,{value:ttreeEvents},_react.default.createElement(_contentWidthContext.default.Provider,{value:contentWidth||_reactNative.Dimensions.get('window').width},_react.default.createElement(RawSourceLoader,props)));},function(_ref3,_ref4){var currSource=_ref4.source,curr=_objectWithoutProperties(_ref4,_excluded3);var prevSource=_ref3.source,prev=_objectWithoutProperties(_ref3,_excluded4);return shallowEqual(prevSource,currSource)&&shallowEqual(prev,curr);});RenderHTMLSource.propTypes=renderSourcePropTypes;var _default=RenderHTMLSource;exports.default=_default;","map":{"version":3,"mappings":"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","names":["renderSourcePropTypes","source","PropTypes","oneOfType","shape","html","string","isRequired","baseUrl","dom","object","uri","method","body","any","headers","onTTreeChange","func","onHTMLLoaded","onDocumentMetadataLoaded","contentWidth","number","isEmptySource","RawSourceLoader","props","__DEV__","console","warn","debugMessage","noSource","React","createElement","SourceLoaderUri","SourceLoaderDom","SourceLoaderInline","shallowEqual","prop1","prop2","Object","keys","key","RenderHTMLSource","RenderHtmlSource","profile","prop","ttreeEvents","_react","_ttreeEventsContext","Provider","value","_contentWidthContext","Dimensions","get","width","currSource","curr","prevSource","prev","propTypes"],"sources":["RenderHTMLSource.tsx"],"sourcesContent":["import equals from 'ramda/src/equals';\nimport React, { memo, ReactElement, useMemo } from 'react';\nimport { Dimensions } from 'react-native';\nimport PropTypes from 'prop-types';\nimport ttreeEventsContext from './context/ttreeEventsContext';\nimport isUriSource from './helpers/isUriSource';\nimport { SourceLoaderProps, TTreeEvents } from './internal-types';\nimport {\n  HTMLSourceDom,\n  HTMLSourceInline,\n  RenderHTMLSourceProps,\n  HTMLSourceUri,\n  HTMLSource\n} from './shared-types';\nimport SourceLoaderUri from './SourceLoaderUri';\nimport SourceLoaderInline from './SourceLoaderInline';\nimport SourceLoaderDom from './SourceLoaderDom';\nimport debugMessage from './debugMessages';\nimport contentWidthContext from './context/contentWidthContext';\nimport isDomSource from './helpers/isDomSource';\nimport useProfiler from './hooks/useProfiler';\n\nexport type RenderHTMLSourcePropTypes = Record<\n  keyof RenderHTMLSourceProps,\n  any\n>;\n\nexport const renderSourcePropTypes: RenderHTMLSourcePropTypes = {\n  source: PropTypes.oneOfType([\n    PropTypes.shape({\n      html: PropTypes.string.isRequired,\n      baseUrl: PropTypes.string\n    }),\n    PropTypes.shape({\n      dom: PropTypes.object.isRequired,\n      baseUrl: PropTypes.string\n    }),\n    PropTypes.shape({\n      uri: PropTypes.string.isRequired,\n      method: PropTypes.string,\n      body: PropTypes.any,\n      headers: PropTypes.object\n    })\n  ]),\n  onTTreeChange: PropTypes.func,\n  onHTMLLoaded: PropTypes.func,\n  onDocumentMetadataLoaded: PropTypes.func,\n  contentWidth: PropTypes.number\n};\n\nfunction isEmptySource(source: undefined | HTMLSource) {\n  return (\n    !source ||\n    (typeof (source as HTMLSourceUri).uri !== 'string' &&\n      typeof (source as HTMLSourceInline).html !== 'string' &&\n      !(source as HTMLSourceDom).dom)\n  );\n}\n\nfunction RawSourceLoader({\n  source,\n  ...props\n}: SourceLoaderProps): ReactElement | null {\n  if (isEmptySource(source)) {\n    /* istanbul ignore next */\n    if (typeof __DEV__ === 'boolean' && __DEV__) {\n      console.warn(debugMessage.noSource);\n    }\n    return null;\n  }\n  if (isUriSource(source)) {\n    return React.createElement(SourceLoaderUri, { source, ...props });\n  }\n  if (isDomSource(source)) {\n    return React.createElement(SourceLoaderDom, { source, ...props });\n  }\n  return React.createElement(SourceLoaderInline, { source, ...props });\n}\n\n// check if for each key of two objects, the values are equal\nfunction shallowEqual(prop1: any, prop2: any) {\n  if (!equals(Object.keys(prop1), Object.keys(prop2))) {\n    return false;\n  }\n  for (const key in prop1) {\n    if (prop1[key] !== prop2[key]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * A React component to render HTML snippets.\n *\n * @remarks This component is useful when you have to load dozens of HTML\n * snippets with the same config. Performance is expected to improve in such\n * scenarios.\n *\n * @warning This component requires to have {@link TRenderEngineProvider}\n * and {@link RenderHTMLConfigProvider} as parents.\n */\nconst RenderHTMLSource = memo(\n  function RenderHtmlSource({\n    onDocumentMetadataLoaded,\n    onTTreeChange,\n    contentWidth,\n    ...props\n  }: RenderHTMLSourceProps) {\n    const profile = useProfiler({\n      prop: 'onDocumentMetadataLoaded or onTTreeChange'\n    });\n    const ttreeEvents: TTreeEvents = useMemo(() => {\n      typeof __DEV__ === 'boolean' && __DEV__ && profile();\n      return {\n        onDocumentMetadataLoaded,\n        onTTreeChange\n      };\n    }, [onDocumentMetadataLoaded, onTTreeChange, profile]);\n    if (typeof __DEV__ === 'boolean' && __DEV__) {\n      if (!(typeof contentWidth === 'number')) {\n        console.warn(debugMessage.contentWidth);\n      }\n    }\n    return (\n      <ttreeEventsContext.Provider value={ttreeEvents}>\n        <contentWidthContext.Provider\n          value={contentWidth || Dimensions.get('window').width}>\n          {React.createElement(RawSourceLoader, props)}\n        </contentWidthContext.Provider>\n      </ttreeEventsContext.Provider>\n    );\n  },\n  ({ source: prevSource, ...prev }, { source: currSource, ...curr }) => {\n    return shallowEqual(prevSource, currSource) && shallowEqual(prev, curr);\n  }\n);\n\n/**\n * @ignore\n */\n(RenderHTMLSource as any).propTypes = renderSourcePropTypes;\n\nexport default RenderHTMLSource;\n"]},"metadata":{},"sourceType":"script"}
{"ast":null,"code":"import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"hideDragIndicator\",\"children\",\"handleClose\",\"pan\",\"sheetHeight\"],_excluded2=[\"_dragIndicator\",\"_dragIndicatorWrapperOffSet\",\"_dragIndicatorWrapper\"],_excluded3=[\"children\"];function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}import React,{memo,forwardRef}from'react';import{Modal}from\"../../composites/Modal\";import{usePropsResolution}from\"../../../hooks\";import Animated from\"react-native-web/dist/exports/Animated\";import PanResponder from\"react-native-web/dist/exports/PanResponder\";import{ModalContext}from\"../Modal/Context\";import Box from\"../../primitives/Box\";import{ActionSheetContext}from\"./ActionSheetContext\";import{useHasResponsiveProps}from\"../../../hooks/useHasResponsiveProps\";var Content=memo(forwardRef(function(_ref,ref){var hideDragIndicator=_ref.hideDragIndicator,children=_ref.children,handleClose=_ref.handleClose,pan=_ref.pan,sheetHeight=_ref.sheetHeight,props=_objectWithoutProperties(_ref,_excluded);var _usePropsResolution=usePropsResolution('ActionsheetContent',props),_dragIndicator=_usePropsResolution._dragIndicator,_dragIndicatorWrapperOffSet=_usePropsResolution._dragIndicatorWrapperOffSet,_dragIndicatorWrapper=_usePropsResolution._dragIndicatorWrapper,resolvedProps=_objectWithoutProperties(_usePropsResolution,_excluded2);var handleCloseRef=React.useRef(null);var handleCloseCallback=React.useCallback(function(){var handleCloseCurrent=handleCloseRef.current;return handleCloseCurrent();},[]);React.useEffect(function(){handleCloseRef.current=handleClose;},[handleClose]);var panResponder=React.useRef(PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onMoveShouldSetPanResponder:function onMoveShouldSetPanResponder(_evt,gestureState){return gestureState.dy>15;},onPanResponderMove:function onPanResponderMove(e,gestureState){if(gestureState.dy>0){Animated.event([null,{dy:pan.y}],{useNativeDriver:false})(e,gestureState);}},onPanResponderRelease:function onPanResponderRelease(_e,gestureState){if(sheetHeight.current/4-gestureState.dy<0){Animated.timing(pan,{toValue:{x:0,y:sheetHeight.current},duration:150,useNativeDriver:true}).start(handleCloseCallback);setTimeout(function(){Animated.timing(pan,{toValue:{x:0,y:0},duration:150,useNativeDriver:true}).start();},300);}else{Animated.spring(pan,{toValue:{x:0,y:0},overshootClamping:true,useNativeDriver:true}).start();}}})).current;return React.createElement(React.Fragment,null,!hideDragIndicator?React.createElement(React.Fragment,null,React.createElement(Box,_extends({},panResponder.panHandlers,_dragIndicatorWrapperOffSet))):null,React.createElement(Modal.Content,_extends({},resolvedProps,{ref:ref,safeAreaBottom:true}),!hideDragIndicator?React.createElement(React.Fragment,null,React.createElement(Box,_extends({},panResponder.panHandlers,_dragIndicatorWrapper),React.createElement(Box,_dragIndicator))):null,children));}));var ActionsheetContent=function ActionsheetContent(_ref2,ref){var children=_ref2.children,props=_objectWithoutProperties(_ref2,_excluded3);var _React$useContext=React.useContext(ModalContext),handleClose=_React$useContext.handleClose;var _React$useContext2=React.useContext(ActionSheetContext),hideDragIndicator=_React$useContext2.hideDragIndicator;var pan=React.useRef(new Animated.ValueXY()).current;var sheetHeight=React.useRef(0);var handleCloseCallback=React.useCallback(handleClose,[ModalContext,handleClose]);if(useHasResponsiveProps(props)){return null;}return React.createElement(Animated.View,{style:{transform:[{translateY:pan.y}],width:'100%'},onLayout:function onLayout(event){var height=event.nativeEvent.layout.height;sheetHeight.current=height;},pointerEvents:\"box-none\"},React.createElement(Content,_extends({children:children,sheetHeight:sheetHeight,pan:pan,hideDragIndicator:hideDragIndicator,handleClose:handleCloseCallback,ref:ref},props)));};export default memo(forwardRef(ActionsheetContent));","map":{"version":3,"mappings":"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","names":["React","memo","forwardRef","Modal","usePropsResolution","ModalContext","Box","ActionSheetContext","useHasResponsiveProps","Content","ref","hideDragIndicator","children","handleClose","pan","sheetHeight","props","_dragIndicator","_dragIndicatorWrapperOffSet","_dragIndicatorWrapper","resolvedProps","handleCloseRef","useRef","handleCloseCallback","useCallback","handleCloseCurrent","current","useEffect","panResponder","PanResponder","create","onStartShouldSetPanResponder","onMoveShouldSetPanResponder","_evt","gestureState","dy","onPanResponderMove","e","Animated","event","y","useNativeDriver","onPanResponderRelease","_e","timing","toValue","x","duration","start","setTimeout","spring","overshootClamping","panHandlers","safeAreaBottom","ActionsheetContent","useContext","ValueXY","View","style","transform","translateY","width","onLayout","height","nativeEvent","layout","pointerEvents"],"sources":["ActionsheetContent.tsx"],"sourcesContent":["import React, { memo, forwardRef } from 'react';\nimport { Modal } from '../../composites/Modal';\nimport type { IActionsheetContentProps } from './types';\nimport { usePropsResolution } from '../../../hooks';\nimport { Animated, PanResponder } from 'react-native';\nimport { ModalContext } from '../Modal/Context';\nimport Box from '../../primitives/Box';\nimport { ActionSheetContext } from './ActionSheetContext';\nimport { useHasResponsiveProps } from '../../../hooks/useHasResponsiveProps';\n\nconst Content = memo(\n  forwardRef(\n    (\n      {\n        hideDragIndicator,\n        children,\n        handleClose,\n        pan,\n        sheetHeight,\n        ...props\n      }: any,\n      ref: any\n    ) => {\n      const {\n        _dragIndicator,\n        _dragIndicatorWrapperOffSet,\n        _dragIndicatorWrapper,\n        ...resolvedProps\n      } = usePropsResolution('ActionsheetContent', props);\n\n      const handleCloseRef = React.useRef(null);\n      const handleCloseCallback = React.useCallback(() => {\n        let handleCloseCurrent = handleCloseRef.current;\n        //@ts-ignore\n        return handleCloseCurrent();\n      }, []);\n      React.useEffect(() => {\n        handleCloseRef.current = handleClose;\n      }, [handleClose]);\n\n      const panResponder = React.useRef(\n        PanResponder.create({\n          onStartShouldSetPanResponder: () => true,\n          onMoveShouldSetPanResponder: (_evt, gestureState) => {\n            return gestureState.dy > 15;\n          },\n          onPanResponderMove: (e, gestureState) => {\n            if (gestureState.dy > 0) {\n              Animated.event([null, { dy: pan.y }], {\n                useNativeDriver: false,\n              })(e, gestureState);\n            }\n          },\n          onPanResponderRelease: (_e, gestureState) => {\n            // If sheet is dragged 1/4th of it's height, close it\n            if (sheetHeight.current / 4 - gestureState.dy < 0) {\n              Animated.timing(pan, {\n                toValue: { x: 0, y: sheetHeight.current },\n                duration: 150,\n                useNativeDriver: true,\n              }).start(handleCloseCallback);\n\n              setTimeout(() => {\n                Animated.timing(pan, {\n                  toValue: { x: 0, y: 0 },\n                  duration: 150,\n                  useNativeDriver: true,\n                }).start();\n              }, 300);\n            } else {\n              Animated.spring(pan, {\n                toValue: { x: 0, y: 0 },\n                overshootClamping: true,\n                useNativeDriver: true,\n              }).start();\n            }\n          },\n        })\n      ).current;\n\n      return (\n        <>\n          {!hideDragIndicator ? (\n            <>\n              {/* To increase the draggable area */}\n              <Box\n                {...panResponder.panHandlers}\n                {..._dragIndicatorWrapperOffSet}\n              />\n            </>\n          ) : null}\n\n          <Modal.Content {...resolvedProps} ref={ref} safeAreaBottom>\n            {!hideDragIndicator ? (\n              <>\n                {/* Hack. Fix later. Add -2 negative margin to remove the padding added by ActionSheetContent */}\n                <Box {...panResponder.panHandlers} {..._dragIndicatorWrapper}>\n                  <Box {..._dragIndicator} />\n                </Box>\n              </>\n            ) : null}\n\n            {children}\n          </Modal.Content>\n        </>\n      );\n    }\n  )\n);\nconst ActionsheetContent = (\n  { children, ...props }: IActionsheetContentProps,\n  ref?: any\n) => {\n  // return null;\n  const { handleClose } = React.useContext(ModalContext);\n  const { hideDragIndicator } = React.useContext(ActionSheetContext);\n  const pan = React.useRef(new Animated.ValueXY()).current;\n  const sheetHeight = React.useRef(0);\n\n  const handleCloseCallback = React.useCallback(handleClose, [\n    ModalContext,\n    handleClose,\n  ]);\n\n  // useEffect(() => {\n\n  // }, [])\n\n  //TODO: refactor for responsive prop\n  if (useHasResponsiveProps(props)) {\n    return null;\n  }\n\n  return (\n    <Animated.View\n      style={{\n        transform: [{ translateY: pan.y }],\n        width: '100%',\n      }}\n      onLayout={(event) => {\n        const { height } = event.nativeEvent.layout;\n        sheetHeight.current = height;\n      }}\n      pointerEvents=\"box-none\"\n    >\n      <Content\n        children={children}\n        sheetHeight={sheetHeight}\n        pan={pan}\n        hideDragIndicator={hideDragIndicator}\n        handleClose={handleCloseCallback}\n        ref={ref}\n        {...props}\n      />\n    </Animated.View>\n  );\n};\n\nexport default memo(forwardRef(ActionsheetContent));\n"]},"metadata":{},"sourceType":"module"}
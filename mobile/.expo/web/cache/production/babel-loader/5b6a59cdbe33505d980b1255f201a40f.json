{"ast":null,"code":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=useImageConcreteDimensions;var _react=require(\"react\");function extractHorizontalSpace(_ref){var marginHorizontal=_ref.marginHorizontal,leftMargin=_ref.leftMargin,rightMargin=_ref.rightMargin,margin=_ref.margin;var realLeftMargin=leftMargin||marginHorizontal||margin||0;var realRightMargin=rightMargin||marginHorizontal||margin||0;return realLeftMargin+realRightMargin;}function scaleUp(minDimensions,desiredDimensions){var aspectRatio=desiredDimensions.width/desiredDimensions.height;if(desiredDimensions.width<minDimensions.width){return scaleUp(minDimensions,{width:minDimensions.width,height:minDimensions.width/aspectRatio});}if(desiredDimensions.height<minDimensions.height){return scaleUp(minDimensions,{height:minDimensions.height,width:minDimensions.height*aspectRatio});}return desiredDimensions;}function scaleDown(maxDimensions,desiredDimensions){var aspectRatio=desiredDimensions.width/desiredDimensions.height;if(desiredDimensions.width>maxDimensions.width){return scaleDown(maxDimensions,{width:maxDimensions.width,height:maxDimensions.width/aspectRatio});}if(desiredDimensions.height>maxDimensions.height){return scaleDown(maxDimensions,{height:maxDimensions.height,width:maxDimensions.height*aspectRatio});}return desiredDimensions;}function scale(_ref2,originalBox){var minBox=_ref2.minBox,maxBox=_ref2.maxBox;return scaleDown(maxBox,scaleUp(minBox,originalBox));}function computeConcreteDimensions(params){var computeMaxWidth=params.computeMaxWidth,contentWidth=params.contentWidth,flattenStyles=params.flattenStyles,naturalWidth=params.naturalWidth,naturalHeight=params.naturalHeight,specifiedWidth=params.specifiedWidth,specifiedHeight=params.specifiedHeight;var horizontalSpace=extractHorizontalSpace(flattenStyles);var _flattenStyles$maxWid=flattenStyles.maxWidth,maxWidth=_flattenStyles$maxWid===void 0?Infinity:_flattenStyles$maxWid,_flattenStyles$maxHei=flattenStyles.maxHeight,maxHeight=_flattenStyles$maxHei===void 0?Infinity:_flattenStyles$maxHei,_flattenStyles$minWid=flattenStyles.minWidth,minWidth=_flattenStyles$minWid===void 0?0:_flattenStyles$minWid,_flattenStyles$minHei=flattenStyles.minHeight,minHeight=_flattenStyles$minHei===void 0?0:_flattenStyles$minHei;var imagesMaxWidth=typeof contentWidth==='number'?computeMaxWidth(contentWidth):Infinity;var minBox={width:minWidth,height:minHeight};var maxBox={width:Math.min(imagesMaxWidth,maxWidth,typeof specifiedWidth==='number'?specifiedWidth:Infinity)-horizontalSpace,height:Math.min(typeof specifiedHeight==='number'?specifiedHeight:Infinity,maxHeight)};if(typeof specifiedWidth==='number'&&typeof specifiedHeight==='number'){return scale({minBox:minBox,maxBox:maxBox},{width:specifiedWidth,height:specifiedHeight});}if(naturalWidth!=null&&naturalHeight!=null){return scale({minBox:minBox,maxBox:maxBox},{width:naturalWidth,height:naturalHeight});}return null;}function useImageConcreteDimensions(_ref3){var flatStyle=_ref3.flatStyle,naturalDimensions=_ref3.naturalDimensions,specifiedDimensions=_ref3.specifiedDimensions,computeMaxWidth=_ref3.computeMaxWidth,contentWidth=_ref3.contentWidth;return(0,_react.useMemo)(function(){return computeConcreteDimensions({flattenStyles:flatStyle,computeMaxWidth:computeMaxWidth,contentWidth:contentWidth,naturalWidth:naturalDimensions===null||naturalDimensions===void 0?void 0:naturalDimensions.width,naturalHeight:naturalDimensions===null||naturalDimensions===void 0?void 0:naturalDimensions.height,specifiedWidth:specifiedDimensions.width,specifiedHeight:specifiedDimensions.height});},[computeMaxWidth,contentWidth,flatStyle,naturalDimensions,specifiedDimensions.height,specifiedDimensions.width]);}","map":{"version":3,"mappings":"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","names":["extractHorizontalSpace","marginHorizontal","leftMargin","rightMargin","margin","realLeftMargin","realRightMargin","scaleUp","minDimensions","desiredDimensions","aspectRatio","width","height","scaleDown","maxDimensions","scale","originalBox","minBox","maxBox","computeConcreteDimensions","params","computeMaxWidth","contentWidth","flattenStyles","naturalWidth","naturalHeight","specifiedWidth","specifiedHeight","horizontalSpace","maxWidth","Infinity","maxHeight","minWidth","minHeight","imagesMaxWidth","Math","min","useImageConcreteDimensions","flatStyle","naturalDimensions","specifiedDimensions"],"sources":["useImageConcreteDimensions.ts"],"sourcesContent":["import { useMemo } from 'react';\nimport { ImageStyle } from 'react-native';\nimport { ImageDimensions } from '../shared-types';\nimport {\n  IncompleteImageDimensions,\n  UseIMGElementStateProps\n} from './img-types';\n\nexport type ConcreteDimensionsProps = {\n  flatStyle: ImageStyle;\n  naturalDimensions: ImageDimensions | null;\n  specifiedDimensions: IncompleteImageDimensions;\n} & Pick<UseIMGElementStateProps, 'computeMaxWidth' | 'contentWidth'>;\n\nfunction extractHorizontalSpace({\n  marginHorizontal,\n  leftMargin,\n  rightMargin,\n  margin\n}: any) {\n  const realLeftMargin = leftMargin || marginHorizontal || margin || 0;\n  const realRightMargin = rightMargin || marginHorizontal || margin || 0;\n  return realLeftMargin + realRightMargin;\n}\n\nfunction scaleUp(\n  minDimensions: ImageDimensions,\n  desiredDimensions: ImageDimensions\n): ImageDimensions {\n  const aspectRatio = desiredDimensions.width / desiredDimensions.height;\n  if (desiredDimensions.width < minDimensions.width) {\n    return scaleUp(minDimensions, {\n      width: minDimensions.width,\n      height: minDimensions.width / aspectRatio\n    });\n  }\n  if (desiredDimensions.height < minDimensions.height) {\n    return scaleUp(minDimensions, {\n      height: minDimensions.height,\n      width: minDimensions.height * aspectRatio\n    });\n  }\n  return desiredDimensions;\n}\n\nfunction scaleDown(\n  maxDimensions: ImageDimensions,\n  desiredDimensions: ImageDimensions\n): ImageDimensions {\n  const aspectRatio = desiredDimensions.width / desiredDimensions.height;\n  if (desiredDimensions.width > maxDimensions.width) {\n    return scaleDown(maxDimensions, {\n      width: maxDimensions.width,\n      height: maxDimensions.width / aspectRatio\n    });\n  }\n  if (desiredDimensions.height > maxDimensions.height) {\n    return scaleDown(maxDimensions, {\n      height: maxDimensions.height,\n      width: maxDimensions.height * aspectRatio\n    });\n  }\n  return desiredDimensions;\n}\n\nfunction scale(\n  { minBox, maxBox }: { maxBox: ImageDimensions; minBox: ImageDimensions },\n  originalBox: ImageDimensions\n) {\n  return scaleDown(maxBox, scaleUp(minBox, originalBox));\n}\n\nfunction computeConcreteDimensions(params: any) {\n  const {\n    computeMaxWidth,\n    contentWidth,\n    flattenStyles,\n    naturalWidth,\n    naturalHeight,\n    specifiedWidth,\n    specifiedHeight\n  } = params;\n  const horizontalSpace = extractHorizontalSpace(flattenStyles);\n  const {\n    maxWidth = Infinity,\n    maxHeight = Infinity,\n    minWidth = 0,\n    minHeight = 0\n  } = flattenStyles;\n  const imagesMaxWidth =\n    typeof contentWidth === 'number' ? computeMaxWidth(contentWidth) : Infinity;\n  const minBox = {\n    width: minWidth,\n    height: minHeight\n  };\n  const maxBox = {\n    width:\n      Math.min(\n        imagesMaxWidth,\n        maxWidth,\n        typeof specifiedWidth === 'number' ? specifiedWidth : Infinity\n      ) - horizontalSpace,\n    height: Math.min(\n      typeof specifiedHeight === 'number' ? specifiedHeight : Infinity,\n      maxHeight\n    )\n  };\n  if (\n    typeof specifiedWidth === 'number' &&\n    typeof specifiedHeight === 'number'\n  ) {\n    return scale(\n      { minBox, maxBox },\n      {\n        width: specifiedWidth,\n        height: specifiedHeight\n      }\n    );\n  }\n  if (naturalWidth != null && naturalHeight != null) {\n    return scale(\n      { minBox, maxBox },\n      {\n        width: naturalWidth,\n        height: naturalHeight\n      }\n    );\n  }\n  return null;\n}\n\nexport default function useImageConcreteDimensions<\n  P extends ConcreteDimensionsProps\n>({\n  flatStyle,\n  naturalDimensions,\n  specifiedDimensions,\n  computeMaxWidth,\n  contentWidth\n}: P): P['naturalDimensions'] extends ImageDimensions\n  ? ImageDimensions\n  : ImageDimensions | null {\n  return useMemo(() => {\n    return computeConcreteDimensions({\n      flattenStyles: flatStyle,\n      computeMaxWidth,\n      contentWidth,\n      naturalWidth: naturalDimensions?.width,\n      naturalHeight: naturalDimensions?.height,\n      specifiedWidth: specifiedDimensions.width,\n      specifiedHeight: specifiedDimensions.height\n    }) as any;\n  }, [\n    computeMaxWidth,\n    contentWidth,\n    flatStyle,\n    naturalDimensions,\n    specifiedDimensions.height,\n    specifiedDimensions.width\n  ]);\n}\n"]},"metadata":{},"sourceType":"script"}